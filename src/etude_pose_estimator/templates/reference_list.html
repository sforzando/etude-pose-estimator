<!-- Reference Pose List Fragment -->
{% if references %}
<!-- Bulk Actions -->
<div class="flex justify-end mb-4">
  <button class="btn btn-sm btn-error" onclick="deleteAllReferences()">
    <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
      <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
    </svg>
    すべて削除
  </button>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  {% for ref in references %}
  <div class="card bg-base-100 shadow-xl transition-all duration-300 hover:scale-105" data-pose-name="{{ ref.name }}" id="pose-{{ ref.name | replace(' ', '-') }}">
    <a href="/references/{{ ref.name }}.html" class="block">
      <figure class="px-6 pt-6 cursor-pointer">
        {% if ref.skeleton_filename %}
        <img src="/api/references/{{ ref.name }}/skeleton" alt="{{ ref.name }}"
          class="rounded-xl max-h-48 object-contain w-full hover:opacity-80 transition-opacity"
          onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 200 200%22%3E%3Crect fill=%22%23ddd%22 width=%22200%22 height=%22200%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%23999%22 font-size=%2214%22%3E骨格なし%3C/text%3E%3C/svg%3E'" />
        {% else %}
        <div class="bg-base-200 rounded-xl h-48 w-full flex items-center justify-center">
          <span class="text-base-content/50">骨格なし</span>
        </div>
        {% endif %}
      </figure>
      <div class="card-body">
        <div class="card-title text-base font-bold">
          {{ ref.name }}
        </div>
        <p class="text-sm text-base-content/70">
          登録日時: {{ ref.created_at[:10] }}
        </p>
      </div>
    </a>

    <div class="card-body pt-0">
      <div class="card-actions justify-end">
        <!-- Delete Button -->
        <button class="btn btn-sm btn-error"
          hx-delete="/api/references/{{ ref.name }}" hx-confirm="「{{ ref.name }}」を削除してもよろしいですか？"
          hx-target="#reference-list-container" hx-swap="innerHTML"
          onclick="event.stopPropagation()">
          <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
          </svg>
          削除
        </button>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="alert">
  <svg fill="none" viewBox="0 0 24 24" class="stroke-info shrink-0 w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
      d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
  </svg>
  <span>基準ポーズが登録されていません。「基準ポーズ登録」タブから登録してください。</span>
</div>
{% endif %}

<script>
  async function deleteAllReferences() {
    if (!confirm('すべての基準ポーズを削除してもよろしいですか？この操作は取り消せません。')) {
      return;
    }

    try {
      const response = await fetch('/api/references', {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        }
      });

      if (response.ok) {
        // Trigger htmx to reload the reference list
        htmx.trigger('#reference-list-container', 'referenceUpdated');
      } else {
        alert('削除に失敗しました');
      }
    } catch (error) {
      console.error('Error deleting all references:', error);
      alert('削除中にエラーが発生しました');
    }
  }
</script>
